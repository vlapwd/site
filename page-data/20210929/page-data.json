{"componentChunkName":"component---src-templates-blog-post-js","path":"/20210929/","result":{"data":{"markdownRemark":{"html":"<p><br>\nformatterのかけ忘れとか、運用ルール決めましょうとか、レビューで指摘しましょうとか</p>\n<p>よく聞くけど、どうでもいいからpre-commitつかんで勝手にやってくれと常々思っていたので</p>\n<p>よし設定するかと思ったら思いの外色々やることになったのでメモを残すことにした</p>\n<h3>###prettier</h3>\n<p>pre-commitつかんでprettierをかけるだけならそう苦労はなく</p>\n<p><a href=\"https://prettier.io/docs/en/precommit.html#option-5-shell-script\">公式に書いてある</a>通りに設定すればよしなにやってくれるようになる。とてもありがたい。。</p>\n<p>僕はchmodを忘れてしばらくハマった</p>\n<p><code>chmod a+x .git/hooks/pre-commit</code></p>\n<pre><code class=\"language-bash\">#!/bin/sh\n# 追加された、コピーされた、変更された、リネームされた、ファイル名を取り出し\nFILES=$(git diff --cached --name-only --diff-filter=ACMR | sed 's| |\\\\ |g')\n[ -z \"$FILES\" ] &#x26;&#x26; exit 0\n\n# Prettify all selected files\n# 取り出したファイルに対してprettierをかけて\necho \"$FILES\" | xargs ./node_modules/.bin/prettier --ignore-unknown --write\n\n# Add back the modified/prettified files to staging\n# 結果をaddし直す\necho \"$FILES\" | xargs git add\n\nexit 0\n</code></pre>\n<h3>###git hooks</h3>\n<p>これで晴れて勝手にprettierをかけてくれるようになった</p>\n<p>ただこのままでは.git/hooksの中身がremote repositoryで共有できない。確かにpushしてないしな。。</p>\n<p>というわけでどうにかしてpre-commitのファイルをcommitに含める必要がある</p>\n<p>今回はgit configにhooksのpathを指定する設定があるので、これを使ってhooksのファイルを.gitから移し、コミットツリーにのせる</p>\n<p><a href=\"https://astatsuya.medium.com/githooks%E3%81%AEpre-push%E3%82%92%E5%85%B1%E6%9C%89%E3%81%97%E3%81%A6%E3%83%AC%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%82%92%E5%81%A5%E5%85%A8%E3%81%AB%E4%BF%9D%E3%81%A4-7156def39b64\">参考</a></p>\n<p>まずは引っ越し先のディレクトリをrepository直下に作成する</p>\n<p><code>mkdir .githooks</code></p>\n<p>そしてその配下に使用するhooksのファイルを配置する</p>\n<p>今回はさっき作ったprettierのpre-commitを移動してくる</p>\n<p><code>mv .git/hooks/pre-commit .githooks/pre-commit</code></p>\n<p>そうしたらgit configでhooksのpathを変更する</p>\n<p><code>git config core.hooksPath .githooks</code></p>\n<p>これで各hookをつかんだ時に.githooks配下の物を実行するようになるので、あとは.githooksをpushしてしまえばいい</p>\n<h3>###課題</h3>\n<p>問題があるとすれば、git configは自分で叩かなければいけないこと</p>\n<p>こういうのはよくやるけど、cloneしてきた時に脳死でyarn install叩いてたりすると防げない</p>\n<pre><code>{\n    \"initialize\":\"yarn install &#x26;&#x26; git config core.hooksPath .githooks\"\n}\n</code></pre>\n<p>もしくは、dockerで開発環境がまとまってればdocker-composeでいい感じにできるかもしれない</p>","frontmatter":{"title":"pre-commitでprettierするのが思ったより苦労したメモ","date":"2021-09-29"}}},"pageContext":{"slug":"/20210929/"}}}